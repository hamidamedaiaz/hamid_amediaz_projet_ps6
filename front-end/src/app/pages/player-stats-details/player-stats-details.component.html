<div class="player-stats-container" *ngIf="profile">
    <div class="header-section">
      <button class="back-button" (click)="navigateBack()">
        <i class="fa fa-arrow-left"></i> Retour
      </button>
      <h1 class="page-title">Statistiques de l'Accueilli</h1>
    </div>
    
    <!-- Section Profil -->
    <div class="profile-section">
      <div class="profile-card">
        <div class="profile-avatar">
          {{ getInitials(profile) }}
        </div>
        <div class="profile-info">
          <h2 class="profile-name">{{ profile.name }} {{ profile.lastName }}</h2>
          <p class="profile-id">ID: {{ profile.id }}</p>
        </div>
      </div>
    </div>
    
    <!-- Section Statistiques Globales -->
    <div class="stats-overview-section">
      <h2 class="section-title">Vue d'ensemble</h2>
      <div class="stats-metrics-grid">
        <div class="metric-card">
          <div class="metric-icon games-icon">
            <i class="fa fa-gamepad"></i>
          </div>
          <div class="metric-content">
            <span class="metric-value">{{ totalGames }}</span>
            <span class="metric-label">Parties jouées</span>
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon success-icon">
            <i class="fa fa-check-circle"></i>
          </div>
          <div class="metric-content">
            <span class="metric-value">{{ successRate }}%</span>
            <span class="metric-label">Score moyen</span>
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon time-icon">
            <i class="fa fa-clock-o"></i>
          </div>
          <div class="metric-content">
            <span class="metric-value">{{ averageTimePerQuestion }}s</span>
            <span class="metric-label">Temps moyen par question</span>
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon hints-icon">
            <i class="fa fa-lightbulb-o"></i>
          </div>
          <div class="metric-content">
            <span class="metric-value">{{ averageHintsUsed }}</span>
            <span class="metric-label">Indices utilisés en moyenne</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Répartition par Catégories -->
    <div class="quiz-categories-section">
      <h2 class="section-title">Quiz par Catégories</h2>
      <div class="categories-chart">
        <div class="category-bar" *ngFor="let category of quizCategoryData" 
            [style.width.%]="category.percentage" 
            [style.background-color]="'#' + (Math.floor(Math.random()*16777215).toString(16))">
          <span class="category-label">{{ category.category }}</span>
          <span class="category-value">{{ category.count }}</span>
        </div>
      </div>
    </div>
    
    <!-- Tendance des Performances -->
    <div class="performance-trend-section">
      <h2 class="section-title">Évolution des Performances</h2>
      
      <div class="tabs-container">
        <button class="tab-btn" [class.active]="activeTab === 'score'" (click)="setActiveTab('score')">
          Score global
        </button>
        <button class="tab-btn" [class.active]="activeTab === 'hints'" (click)="setActiveTab('hints')">
          Utilisation des indices
        </button>
        <button class="tab-btn" [class.active]="activeTab === 'time'" (click)="setActiveTab('time')">
          Temps de réponse
        </button>
        <button class="tab-btn" [class.active]="activeTab === 'accuracy'" (click)="setActiveTab('accuracy')">
          Précision
        </button>
      </div>
      
      <div class="performance-chart">
        <div class="chart-bar" *ngFor="let performance of monthlyPerformance">
          <div class="bar-column" [style.height.%]="performance.score">
            <span class="bar-value">{{ performance.score }}%</span>
          </div>
          <span class="bar-label">{{ performance.month }}</span>
        </div>
      </div>
    </div>
    
    <!-- Métriques thérapeutiques spécifiques -->
    <div class="therapy-metrics-section">
      <h2 class="section-title">Métriques Thérapeutiques</h2>
      <div class="therapy-metrics-grid">
        <!-- Nombre d'indices utilisés -->
        <div class="therapy-metric-card">
          <h3 class="therapy-metric-title">Indices Utilisés</h3>
          <div class="therapy-metric-value">{{ totalHintsUsed }}</div>
          <div class="therapy-metric-description">Nombre total d'indices utilisés sur l'ensemble des parties</div>
        </div>
        
        <!-- Temps moyen entre les réponses -->
        <div class="therapy-metric-card">
          <h3 class="therapy-metric-title">Temps Entre Réponses</h3>
          <div class="therapy-metric-value">{{ avgTimeBetweenAnswers.toFixed(1) }}s</div>
          <div class="therapy-metric-description">Temps moyen entre chaque réponse donnée</div>
        </div>
        
        <!-- Nombre de bonnes réponses sélectionnées -->
        <div class="therapy-metric-card">
          <h3 class="therapy-metric-title">Bonnes Réponses</h3>
          <div class="therapy-metric-value">{{ totalCorrectAnswers }}</div>
          <div class="therapy-metric-description">Nombre total de bonnes réponses sélectionnées</div>
        </div>
        
        <!-- Nombre de mauvaises réponses sélectionnées -->
        <div class="therapy-metric-card">
          <h3 class="therapy-metric-title">Mauvaises Réponses</h3>
          <div class="therapy-metric-value">{{ totalIncorrectAnswers }}</div>
          <div class="therapy-metric-description">Nombre total de mauvaises réponses sélectionnées</div>
        </div>
      </div>
      
      <!-- Graphique en barres pour les réponses correctes/incorrectes -->
      <div class="answers-distribution">
        <h3 class="answers-distribution-title">Distribution des Réponses</h3>
        <div class="answers-chart">
          <div class="answer-segment correct" [style.width.%]="correctAnswersPercent">
            <span class="segment-label">{{ correctAnswersPercent }}% Correctes</span>
          </div>
          <div class="answer-segment incorrect" [style.width.%]="incorrectAnswersPercent">
            <span class="segment-label">{{ incorrectAnswersPercent }}% Incorrectes</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Liste des Quiz Joués -->
    <div class="quiz-history-section">
      <h2 class="section-title">Historique des Quiz</h2>
      <div class="quiz-history-table-container">
        <table class="quiz-history-table">
          <thead>
            <tr>
              <th>Quiz</th>
              <th>Date</th>
              <th>Score</th>
              <th>Temps Moyen</th>
              <th>Indices Utilisés</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let result of quizResults">
              <td class="quiz-title">{{ result.quizTitle }}</td>
              <td>{{ result.date }}</td>
              <td>
                <div class="score-display" [ngClass]="getScoreColor(result.percentageCorrect)">
                  {{ result.score }}/{{ result.totalQuestions }}
                  <span class="score-percentage">({{ result.percentageCorrect }}%)</span>
                </div>
              </td>
              <td>{{ result.timeSpent }}s</td>
              <td>{{ result.hintsUsed }}</td>
              <td>
                <button class="view-details-btn" (click)="viewQuizDetails(result.quizId)">
                  Détails
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <div class="loading-container" *ngIf="!profile">
    <div class="spinner"></div>
    <p class="loading-text">Chargement des données...</p>
  </div>